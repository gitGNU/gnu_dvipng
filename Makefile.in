CC = @CC@
CFLAGS = @CFLAGS@ -Wall
CPPFLAGS = @CPPFLAGS@ -I. -DDEBUG

LIBS = @LIBS@
LDFLAGS = @LDFLAGS@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
INSTALL = @INSTALL@

MAKEINFO=@MAKEINFO@ @MAKEINFO_MACROS@
INSTALL_INFO=@INSTALL_INFO@
TEX=tex
TEXINDEX=texindex
TEXIHTML=texi2html
DVIPS=dvips
TEXIFILES = dvipng.texi install.texi macros.texi dvipng.help

objects = dvipng.o color.o draw.o dvi.o font.o misc.o pk.o \
	set.o special.o papersiz.o ppagelist.o vf.o

all: dvipng docs

dvipng: $(objects)
	$(CC) $(LDFLAGS) $(objects) -o dvipng $(LIBS) 

$(objects): dvipng.h commands.h config.h

install: dvipng
	$(INSTALL) dvipng $(bindir)

docs: dvipng.dvi dvipng.info

dvipng.dvi: $(TEXIFILES)
	-$(TEX) "\nonstopmode\input dvipng.texi"
	-$(TEXINDEX) dvipng.cp
	-$(TEX) "\nonstopmode\input dvipng.texi"

# SunOS make suffix rule wierdness
.cps.h:

dvipng.ps: dvipng.dvi
	$(DVIPS) dvipng.dvi -o dvipng.ps

dvipng.info: $(TEXIFILES)
	-$(MAKEINFO) dvipng.texi

dvipng.help: 
	rm dvipng.tmp
	-./dvipng > dvipng.tmp
	diff dvipng.tmp dvipng.help || cp dvipng.tmp dvipng.help

clean:
	rm -f *.o dvipng

distclean: clean
	rm -f Makefile
	rm -f config.status config.log config.cache c-auto.h
